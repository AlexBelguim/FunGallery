!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).Handy={})}(this,(function(t){"use strict";const e={API:"https://www.handyfeeling.com/api/handy/v2",scriptAPI:"https://scripts01.handyfeeling.com/api/script/v0",UUI:{URL:"https://universalui.handyfeeling.com",theme:"default",storeURL:"https://thehandy.com/",errorAlign:"left"},syncClientServerTime:!0,syncClient:{syncCount:30,outliers:10},syncHandy:{syncCount:30,outliers:10},videoPlayerDelayForSecondPlay:2500,timeBetweenSyncs:36e5,throttleDelay:200,localStorage:"undefined"!=typeof localStorage?localStorage:void 0};function n(t,e){const{syncClient:n,syncHandy:s,UUI:r,localStorage:i,...o}=t,{syncClient:a,syncHandy:u,UUI:c,localStorage:l,...d}=e;return{...o,...d,syncClient:{...n,...a},syncHandy:{...s,...u},UUI:{...r,...c},localStorage:l?{...i,...l}:i}}class s{config;constructor(t){this.config=t}}class r extends Error{url;status;statusText;body;request;constructor(t,e,n){super(n),this.name="ApiError",this.url=e.url,this.status=e.status,this.statusText=e.statusText,this.body=e.body,this.request=t}}class i extends Error{constructor(t){super(t),this.name="CancelError"}get isCancelled(){return!0}}class o{[Symbol.toStringTag];_isResolved;_isRejected;_isCancelled;_cancelHandlers;_promise;_resolve;_reject;constructor(t){this._isResolved=!1,this._isRejected=!1,this._isCancelled=!1,this._cancelHandlers=[],this._promise=new Promise(((e,n)=>{this._resolve=e,this._reject=n;const s=t=>{this._isResolved||this._isRejected||this._isCancelled||this._cancelHandlers.push(t)};return Object.defineProperty(s,"isResolved",{get:()=>this._isResolved}),Object.defineProperty(s,"isRejected",{get:()=>this._isRejected}),Object.defineProperty(s,"isCancelled",{get:()=>this._isCancelled}),t((t=>{this._isResolved||this._isRejected||this._isCancelled||(this._isResolved=!0,this._resolve?.(t))}),(t=>{this._isResolved||this._isRejected||this._isCancelled||(this._isRejected=!0,this._reject?.(t))}),s)}))}then(t,e){return this._promise.then(t,e)}catch(t){return this._promise.catch(t)}finally(t){return this._promise.finally(t)}cancel(){if(!(this._isResolved||this._isRejected||this._isCancelled)){if(this._isCancelled=!0,this._cancelHandlers.length)try{for(const t of this._cancelHandlers)t()}catch(t){return void console.warn("Cancellation threw an error",t)}this._cancelHandlers.length=0,this._reject?.(new i("Request aborted"))}}get isCancelled(){return this._isCancelled}}const a=t=>null!=t,u=t=>"string"==typeof t,c=t=>u(t)&&""!==t,l=t=>"object"==typeof t&&"string"==typeof t.type&&"function"==typeof t.stream&&"function"==typeof t.arrayBuffer&&"function"==typeof t.constructor&&"string"==typeof t.constructor.name&&/^(Blob|File)$/.test(t.constructor.name)&&/^(Blob|File)$/.test(t[Symbol.toStringTag]),d=t=>t instanceof FormData,h=t=>{const e=[],n=(t,s)=>{a(s)&&(Array.isArray(s)?s.forEach((e=>{n(t,e)})):"object"==typeof s?Object.entries(s).forEach((([e,s])=>{n(`${t}[${e}]`,s)})):((t,n)=>{e.push(`${encodeURIComponent(t)}=${encodeURIComponent(String(n))}`)})(t,s))};return Object.entries(t).forEach((([t,e])=>{n(t,e)})),e.length>0?`?${e.join("&")}`:""},p=async(t,e)=>"function"==typeof e?e(t):e,_=async(t,e)=>{const n=await p(e,t.TOKEN),s=await p(e,t.USERNAME),r=await p(e,t.PASSWORD),i=await p(e,t.HEADERS),o=Object.entries({Accept:"application/json",...i,...e.headers}).filter((([t,e])=>a(e))).reduce(((t,[e,n])=>({...t,[e]:String(n)})),{});if(c(n)&&(o.Authorization=`Bearer ${n}`),c(s)&&c(r)){const t=(t=>{try{return btoa(t)}catch(e){return Buffer.from(t).toString("base64")}})(`${s}:${r}`);o.Authorization=`Basic ${t}`}return e.body&&(e.mediaType?o["Content-Type"]=e.mediaType:l(e.body)?o["Content-Type"]=e.body.type||"application/octet-stream":u(e.body)?o["Content-Type"]="text/plain":d(e.body)||(o["Content-Type"]="application/json")),new Headers(o)},f=(t,e)=>new o((async(n,s,i)=>{try{const s=((t,e)=>{const n=t.ENCODE_PATH||encodeURI,s=e.url.replace("{api-version}",t.VERSION).replace(/{(.*?)}/g,((t,s)=>e.path?.hasOwnProperty(s)?n(String(e.path[s])):t)),r=`${t.BASE}${s}`;return e.query?`${r}${h(e.query)}`:r})(t,e),o=(t=>{if(t.formData){const e=new FormData,n=(t,n)=>{u(n)||l(n)?e.append(t,n):e.append(t,JSON.stringify(n))};return Object.entries(t.formData).filter((([t,e])=>a(e))).forEach((([t,e])=>{Array.isArray(e)?e.forEach((e=>n(t,e))):n(t,e)})),e}})(e),c=(t=>{if(t.body)return t.mediaType?.includes("/json")?JSON.stringify(t.body):u(t.body)||l(t.body)||d(t.body)?t.body:JSON.stringify(t.body)})(e),p=await _(t,e);if(!i.isCancelled){const a=await(async(t,e,n,s,r,i,o)=>{const a=new AbortController,u={headers:i,body:s??r,method:e.method,signal:a.signal};return t.WITH_CREDENTIALS&&(u.credentials=t.CREDENTIALS),o((()=>a.abort())),await fetch(n,u)})(t,e,s,c,o,p,i),l=await(async t=>{if(204!==t.status)try{const e=t.headers.get("Content-Type");if(e)return e.toLowerCase().startsWith("application/json")?await t.json():await t.text()}catch(t){console.error(t)}})(a),d=((t,e)=>{if(e){const n=t.headers.get(e);if(u(n))return n}})(a,e.responseHeader),h={url:s,ok:a.ok,status:a.status,statusText:a.statusText,body:d??l};((t,e)=>{const n={400:"Bad Request",401:"Unauthorized",403:"Forbidden",404:"Not Found",500:"Internal Server Error",502:"Bad Gateway",503:"Service Unavailable",...t.errors}[e.status];if(n)throw new r(t,e,n);if(!e.ok)throw new r(t,e,"Generic Error")})(e,h),n(h.body)}}catch(t){s(t)}}));class y extends s{constructor(t){super(t)}request(t){return f(this.config,t)}}class S{httpRequest;constructor(t){this.httpRequest=t}getMode(t){return this.httpRequest.request({method:"GET",url:"/mode",headers:{"X-Connection-Key":t},errors:{400:"Bad request."}})}setMode(t,e){return this.httpRequest.request({method:"PUT",url:"/mode",headers:{"X-Connection-Key":t},body:e,mediaType:"application/json",errors:{400:"Bad request."}})}isConnected(t){return this.httpRequest.request({method:"GET",url:"/connected",headers:{"X-Connection-Key":t},errors:{400:"Bad request."}})}getInfo(t){return this.httpRequest.request({method:"GET",url:"/info",headers:{"X-Connection-Key":t},errors:{400:"Bad request."}})}getSettings(t){return this.httpRequest.request({method:"GET",url:"/settings",headers:{"X-Connection-Key":t},errors:{400:"Bad request."}})}getStatus(t){return this.httpRequest.request({method:"GET",url:"/status",headers:{"X-Connection-Key":t},errors:{400:"Bad request."}})}}class m{httpRequest;constructor(t){this.httpRequest=t}start(t){return this.httpRequest.request({method:"PUT",url:"/hamp/start",headers:{"X-Connection-Key":t},errors:{400:"Bad request."}})}hampStop(t){return this.httpRequest.request({method:"PUT",url:"/hamp/stop",headers:{"X-Connection-Key":t},errors:{400:"Bad request."}})}getHampVelocityPercent(t){return this.httpRequest.request({method:"GET",url:"/hamp/velocity",headers:{"X-Connection-Key":t},errors:{400:"Bad request."}})}setHampVelocityPercent(t,e){return this.httpRequest.request({method:"PUT",url:"/hamp/velocity",headers:{"X-Connection-Key":t},body:e,mediaType:"application/json",errors:{400:"Bad request."}})}getHampState(t){return this.httpRequest.request({method:"GET",url:"/hamp/state",headers:{"X-Connection-Key":t},errors:{400:"Bad request."}})}}class E{httpRequest;constructor(t){this.httpRequest=t}nextPostionAbsVelocityAbs(t,e){return this.httpRequest.request({method:"PUT",url:"/hdsp/xava",headers:{"X-Connection-Key":t},body:e,mediaType:"application/json",errors:{400:"Bad request."}})}nextPositionPercentVelocityAbsolute(t,e){return this.httpRequest.request({method:"PUT",url:"/hdsp/xpva",headers:{"X-Connection-Key":t},body:e,mediaType:"application/json",errors:{400:"Bad request."}})}nextPositionPercentVelocityPercent(t,e){return this.httpRequest.request({method:"PUT",url:"/hdsp/xpvp",headers:{"X-Connection-Key":t},body:e,mediaType:"application/json",errors:{400:"Bad request."}})}nextPositionAbsInTime(t,e){return this.httpRequest.request({method:"PUT",url:"/hdsp/xat",headers:{"X-Connection-Key":t},body:e,mediaType:"application/json",errors:{400:"Bad request."}})}nextPositionPercentInTime(t,e){return this.httpRequest.request({method:"PUT",url:"/hdsp/xpt",headers:{"X-Connection-Key":t},body:e,mediaType:"application/json",errors:{400:"Bad request."}})}}class g{httpRequest;constructor(t){this.httpRequest=t}play(t,e){return this.httpRequest.request({method:"PUT",url:"/hssp/play",headers:{"X-Connection-Key":t},body:e,mediaType:"application/json",errors:{400:"Bad request."}})}hsspStop(t){return this.httpRequest.request({method:"PUT",url:"/hssp/stop",headers:{"X-Connection-Key":t},errors:{400:"Bad request."}})}setup(t,e){return this.httpRequest.request({method:"PUT",url:"/hssp/setup",headers:{"X-Connection-Key":t},body:e,mediaType:"application/json",errors:{400:"Bad request."}})}getLoopSetting(t){return this.httpRequest.request({method:"GET",url:"/hssp/loop",headers:{"X-Connection-Key":t},errors:{400:"Bad request."}})}setLoopSetting(t,e){return this.httpRequest.request({method:"PUT",url:"/hssp/loop",headers:{"X-Connection-Key":t},body:e,mediaType:"application/json",errors:{400:"Bad request."}})}getHsspState(t){return this.httpRequest.request({method:"GET",url:"/hssp/state",headers:{"X-Connection-Key":t},errors:{400:"Bad request."}})}}class w{httpRequest;constructor(t){this.httpRequest=t}getDeviceTime(t){return this.httpRequest.request({method:"GET",url:"/hstp/time",headers:{"X-Connection-Key":t},errors:{400:"Bad request."}})}getOffset(t){return this.httpRequest.request({method:"GET",url:"/hstp/offset",headers:{"X-Connection-Key":t},errors:{400:"Bad request."}})}setOffset(t,e){return this.httpRequest.request({method:"PUT",url:"/hstp/offset",headers:{"X-Connection-Key":t},body:e,mediaType:"application/json",errors:{400:"Bad request."}})}getRoundTripDelay(t){return this.httpRequest.request({method:"GET",url:"/hstp/rtd",headers:{"X-Connection-Key":t},errors:{400:"Bad request."}})}sync(t,e,n){return this.httpRequest.request({method:"GET",url:"/hstp/sync",headers:{"X-Connection-Key":t},query:{syncCount:e,outliers:n},errors:{400:"Bad request."}})}}class v{httpRequest;constructor(t){this.httpRequest=t}restart(t,e){return this.httpRequest.request({method:"PUT",url:"/maintenance/restart",headers:{"X-Connection-Key":t},body:e,mediaType:"application/json",errors:{400:"Bad request."}})}updatePerformFw(t,e){return this.httpRequest.request({method:"PUT",url:"/maintenance/update/perform",headers:{"X-Connection-Key":t},body:e,mediaType:"application/json",errors:{400:"Bad request."}})}getUpdateStatus(t){return this.httpRequest.request({method:"GET",url:"/maintenance/update/status",headers:{"X-Connection-Key":t},errors:{400:"Bad request."}})}}class R{httpRequest;constructor(t){this.httpRequest=t}latest(t,e){return this.httpRequest.request({method:"GET",url:"/ota/latest",query:{model:t,branch:e},errors:{400:"Bad request."}})}}class P{httpRequest;constructor(t){this.httpRequest=t}getSlide(t){return this.httpRequest.request({method:"GET",url:"/slide",headers:{"X-Connection-Key":t},errors:{400:"Bad request."}})}setSlide(t,e){return this.httpRequest.request({method:"PUT",url:"/slide",headers:{"X-Connection-Key":t},body:e,mediaType:"application/json",errors:{400:"Bad request."}})}getPositionAbs(t){return this.httpRequest.request({method:"GET",url:"/slide/position/absolute",headers:{"X-Connection-Key":t},errors:{400:"Bad request."}})}}class T{httpRequest;constructor(t){this.httpRequest=t}getServerTime(){return this.httpRequest.request({method:"GET",url:"/servertime",errors:{400:"Bad request."}})}}class b{base;hamp;hdsp;hssp;hstp;maintenance;ota;slide;timesync;request;constructor(t,e=y){this.request=new e({BASE:t?.BASE??"https://www.handyfeeling.com/api/handy/v2",VERSION:t?.VERSION??"2.0.0-beta-3",WITH_CREDENTIALS:t?.WITH_CREDENTIALS??!1,CREDENTIALS:t?.CREDENTIALS??"include",TOKEN:t?.TOKEN,USERNAME:t?.USERNAME,PASSWORD:t?.PASSWORD,HEADERS:t?.HEADERS,ENCODE_PATH:t?.ENCODE_PATH}),this.base=new S(this.request),this.hamp=new m(this.request),this.hdsp=new E(this.request),this.hssp=new g(this.request),this.hstp=new w(this.request),this.maintenance=new v(this.request),this.ota=new R(this.request),this.slide=new P(this.request),this.timesync=new T(this.request)}}var C,A,N,O,q,D,I,H,M,U,x,k,L,j,K,B,V,G,F,X,$,W;t.BASEModeErrors=void 0,(C=t.BASEModeErrors||(t.BASEModeErrors={}))[C.ERROR=2e3]="ERROR",C[C.INVALID_REQUEST=2001]="INVALID_REQUEST",C[C.METHOD_NOT_FOUND=2002]="METHOD_NOT_FOUND",t.Branch=void 0,(A=t.Branch||(t.Branch={})).MASTER="master",A.STAGING="master-staging",t.FirmwareStatus=void 0,(N=t.FirmwareStatus||(t.FirmwareStatus={}))[N.UP_TO_DATE=0]="UP_TO_DATE",N[N.UPDATE_REQUIRED=1]="UPDATE_REQUIRED",N[N.UPDATE_AVAILABLE=2]="UPDATE_AVAILABLE",t.GenericResult=void 0,(O=t.GenericResult||(t.GenericResult={}))[O.SUCCESS=0]="SUCCESS",O[O.ERROR=-1]="ERROR",t.HAMPModeErrors=void 0,(q=t.HAMPModeErrors||(t.HAMPModeErrors={}))[q.ERROR=3e3]="ERROR",t.HAMPState=void 0,(D=t.HAMPState||(t.HAMPState={}))[D.STOPPED=1]="STOPPED",D[D.MOVING=2]="MOVING",t.HDSPModeErrors=void 0,(I=t.HDSPModeErrors||(t.HDSPModeErrors={}))[I.ERROR=5e3]="ERROR",t.HDSPResult=void 0,(H=t.HDSPResult||(t.HDSPResult={}))[H.ERROR=-3]="ERROR",H[H.SUCCESS_POSITION_REACHED=0]="SUCCESS_POSITION_REACHED",H[H.SUCCESS_POSITION_NOT_REACHED=1]="SUCCESS_POSITION_NOT_REACHED",H[H.SUCCES_ALREADY_AT_POSITION=2]="SUCCES_ALREADY_AT_POSITION",H[H.SUCCESS_INTERRTUPTED=3]="SUCCESS_INTERRTUPTED",t.HSSPModeErrors=void 0,(M=t.HSSPModeErrors||(t.HSSPModeErrors={}))[M.ERROR=4e3]="ERROR",M[M.DOWNLOAD_FAILED=4001]="DOWNLOAD_FAILED",M[M.HASH_ERROR=4002]="HASH_ERROR",M[M.SYNC_REQUIRED=4003]="SYNC_REQUIRED",M[M.TOKEN_ERROR=4004]="TOKEN_ERROR",M[M.MAX_SCRIPT_SIZE_ERROR=4005]="MAX_SCRIPT_SIZE_ERROR",M[M.DEVICE_STORAGE_FULL_ERROR=4006]="DEVICE_STORAGE_FULL_ERROR",M[M.DEVICE_STORAGE_FREE_ERROR=4007]="DEVICE_STORAGE_FREE_ERROR",M[M.DEVICE_STORAGE_CLEAN_ERROR=4008]="DEVICE_STORAGE_CLEAN_ERROR",t.HSSPPlayResult=void 0,(U=t.HSSPPlayResult||(t.HSSPPlayResult={}))[U.SUCCESS=0]="SUCCESS",U[U.ERROR=-1]="ERROR",t.HSSPSetupResult=void 0,(x=t.HSSPSetupResult||(t.HSSPSetupResult={}))[x.USING_CACHED=0]="USING_CACHED",x[x.DOWNLOADED=1]="DOWNLOADED",t.HSSPState=void 0,(k=t.HSSPState||(t.HSSPState={}))[k.NEED_SYNC=1]="NEED_SYNC",k[k.NEED_SETUP=2]="NEED_SETUP",k[k.STOPPED=3]="STOPPED",k[k.PLAYING=4]="PLAYING",t.MAINTENANCEModeErrors=void 0,(L=t.MAINTENANCEModeErrors||(t.MAINTENANCEModeErrors={}))[L.ERROR=6e3]="ERROR",L[L.RESTART_FAILED=6001]="RESTART_FAILED",t.Mode=void 0,(j=t.Mode||(t.Mode={}))[j.HAMP=0]="HAMP",j[j.HSSP=1]="HSSP",j[j.HDSP=2]="HDSP",j[j.MAINTENANCE=3]="MAINTENANCE",j[j.HBSP=4]="HBSP",t.Model=void 0,(t.Model||(t.Model={})).H01="H01",t.ModeUpdateResponse=void 0,K=t.ModeUpdateResponse||(t.ModeUpdateResponse={}),(B=K.result||(K.result={}))[B.ERROR=-1]="ERROR",B[B.SUCCESS_NEW_MODE=0]="SUCCESS_NEW_MODE",B[B.SUCCESS_SAME_MODE=1]="SUCCESS_SAME_MODE",t.SlideResult=void 0,(V=t.SlideResult||(t.SlideResult={}))[V.ACCEPTED=0]="ACCEPTED",V[V.ACCEPTED_ROUNDED_DOWN=1]="ACCEPTED_ROUNDED_DOWN",V[V.ACCEPTED_ROUNDED_UP=2]="ACCEPTED_ROUNDED_UP",t.StateResult=void 0,(G=t.StateResult||(t.StateResult={}))[G.ERROR=-1]="ERROR",G[G.SUCCESS_NEW_STATE=0]="SUCCESS_NEW_STATE",G[G.SUCCESS_SAME_STATE=1]="SUCCESS_SAME_STATE",t.UpdateStatusResponse=void 0,F=t.UpdateStatusResponse||(t.UpdateStatusResponse={}),(X=F.status||(F.status={}))[X.PENDING=0]="PENDING",X[X.IN_PROGRESS=1]="IN_PROGRESS",X[X.SUCCESS=2]="SUCCESS",X[X.FAILED=3]="FAILED",t.ConnectResult=void 0,($=t.ConnectResult||(t.ConnectResult={}))[$.NOT_CONNECTED=0]="NOT_CONNECTED",$[$.CONNECTED=1]="CONNECTED",t.Status=void 0,(W=t.Status||(t.Status={}))[W.NOT_CONNECTED=0]="NOT_CONNECTED",W[W.CONNECTING=1]="CONNECTING",W[W.CONNECTION_FAILED=2]="CONNECTION_FAILED",W[W.CONNECTED=3]="CONNECTED",W[W.UPDATE=4]="UPDATE",W[W.DEPRECATED=5]="DEPRECATED",W[W.SETTING_SCRIPT=6]="SETTING_SCRIPT";let z=!1,Z=[];const Y=t=>{const e={...t,callback:t.callback,updateState:t.updateState,timestamp:Date.now()};return e.skip?J(e):(Z.push(e),1!==Z.length||z?void 0:Q())},J=async t=>{const{callback:{res:e,rej:n},request:s,handy:r,updateState:i,noStateUpdate:o}=t;try{const n=await s();if(et(n))throw n.error;if(r&&!o)if(i)i(r,n);else{let e=n;if("result"in n){const{result:t,...s}=n;e=s}const s=r.getState(),i=t.sub?{[t.sub]:{...s[t.sub],...e}}:{...e};r.updateState(i)}e(n)}catch(t){n(t)}},Q=async()=>{z=!0;const t=tt();t?(await J(t),z=!1,Z=Z.filter((({request:e,handy:n})=>e!==t.request||n!==t.handy)),Z.length&&Q()):z=!1},tt=()=>{const t=Z.sort(((t,e)=>t.timestamp-e.timestamp)),e=[];for(const n of t){const t=e.findIndex((({request:t,handy:e})=>n.request===t&&n.handy===e));-1===t&&e.push(n)}return e[0]},et=t=>"error"in t,nt=e=>{const n=e.getConfig(),s=new b({BASE:n.API});return{get:{mode:(t,n=!1)=>new Promise(((r,i)=>{Y({handy:e,noStateUpdate:n,request:()=>s.base.getMode(t),callback:{res:r,rej:i}})})),connected:(t,n=!1)=>new Promise(((r,i)=>{Y({handy:e,noStateUpdate:n,request:()=>s.base.isConnected(t),callback:{res:r,rej:i}})})),info:(t,n=!1)=>new Promise(((r,i)=>{Y({handy:e,noStateUpdate:n,sub:"info",request:()=>s.base.getInfo(t),callback:{res:r,rej:i}})})),settings:(t,n=!1)=>new Promise(((r,i)=>{Y({handy:e,noStateUpdate:n,request:()=>s.base.getSettings(t),updateState:(t,e)=>{t.updateState({slide:{max:e.slideMax,min:e.slideMin}})},callback:{res:r,rej:i}})})),status:(n,r=!1)=>new Promise(((i,o)=>{Y({handy:e,noStateUpdate:r,request:()=>s.base.getStatus(n),updateState:(e,{mode:n,state:s})=>{const r={mode:n};n===t.Mode.HSSP&&(r.hssp={state:s}),n===t.Mode.HAMP&&(r.hamp={state:s}),e.updateState(r)},callback:{res:i,rej:o}})})),slide:(t,n=!1)=>new Promise(((r,i)=>{Y({handy:e,noStateUpdate:n,sub:"slide",request:()=>s.slide.getSlide(t),callback:{res:r,rej:i}})})),slidePositionAbsolute:(t,n=!1)=>new Promise(((r,i)=>{Y({handy:e,noStateUpdate:n,sub:"slide",request:()=>s.slide.getPositionAbs(t),callback:{res:r,rej:i}})})),serverTime:()=>new Promise(((t,e)=>{Y({request:()=>s.timesync.getServerTime(),callback:{res:t,rej:e}})})),HAMP:{velocity:(t,n=!1)=>new Promise(((r,i)=>{Y({handy:e,noStateUpdate:n,sub:"hamp",request:()=>s.hamp.getHampVelocityPercent(t),callback:{res:r,rej:i}})})),state:(t,n=!1)=>new Promise(((r,i)=>{Y({handy:e,noStateUpdate:n,sub:"hamp",request:()=>s.hamp.getHampState(t),callback:{res:r,rej:i}})}))},HDSP:{},HSSP:{state:(t,n=!1)=>new Promise(((r,i)=>{Y({handy:e,noStateUpdate:n,sub:"hssp",request:()=>s.hssp.getHsspState(t),callback:{res:r,rej:i}})})),loop:(t,n=!1)=>new Promise(((r,i)=>{Y({handy:e,noStateUpdate:n,request:()=>s.hssp.getLoopSetting(t),updateState:(t,{activated:e})=>t.updateState({hssp:{loop:e}}),callback:{res:r,rej:i}})}))},HSTP:{time:(t,n=!1)=>new Promise(((r,i)=>{Y({handy:e,noStateUpdate:n,sub:"hstp",request:()=>s.hstp.getDeviceTime(t),callback:{res:r,rej:i}})})),offset:(t,n=!1)=>new Promise(((r,i)=>{Y({handy:e,noStateUpdate:n,sub:"hstp",request:()=>s.hstp.getOffset(t),callback:{res:r,rej:i}})})),rtd:(t,n=!1)=>new Promise(((r,i)=>{Y({handy:e,noStateUpdate:n,sub:"hstp",request:()=>s.hstp.getRoundTripDelay(t),callback:{res:r,rej:i}})})),sync:(t,n,r,i=!1)=>new Promise(((o,a)=>{Y({handy:e,noStateUpdate:i,sub:"hstp",request:()=>s.hstp.sync(t,n,r),callback:{res:o,rej:a}})}))},MAINTENANCE:{getUpdateStatus:t=>new Promise(((e,n)=>{Y({request:()=>s.maintenance.getUpdateStatus(t),callback:{res:e,rej:n}})}))},OTA:{latest:(t,n,r=!1)=>new Promise(((i,o)=>{Y({handy:e,noStateUpdate:r,sub:"ota",request:()=>s.ota.latest(t,n),callback:{res:i,rej:o}})}))}},put:{mode:(t,n)=>new Promise(((r,i)=>{Y({handy:e,request:()=>s.base.setMode(t,n),callback:{res:r,rej:i}})})),slide:(t,n)=>new Promise(((r,i)=>{Y({handy:e,request:()=>s.slide.setSlide(t,n),callback:{res:r,rej:i}})})),HAMP:{start:t=>new Promise(((n,r)=>{Y({handy:e,request:()=>s.hamp.start(t),callback:{res:n,rej:r}})})),stop:t=>new Promise(((n,r)=>{Y({handy:e,request:()=>s.hamp.hampStop(t),callback:{res:n,rej:r}})})),velocity:(t,n)=>new Promise(((r,i)=>{Y({handy:e,request:()=>s.hamp.setHampVelocityPercent(t,n),callback:{res:r,rej:i}})}))},HDSP:{xava:(t,n)=>new Promise(((r,i)=>{Y({handy:e,request:()=>s.hdsp.nextPostionAbsVelocityAbs(t,n),callback:{res:r,rej:i}})})),xpva:(t,n)=>new Promise(((r,i)=>{Y({handy:e,request:()=>s.hdsp.nextPositionPercentVelocityAbsolute(t,n),callback:{res:r,rej:i}})})),xpvp:(t,n)=>new Promise(((r,i)=>{Y({handy:e,request:()=>s.hdsp.nextPositionPercentVelocityPercent(t,n),callback:{res:r,rej:i}})})),xat:(t,n)=>new Promise(((r,i)=>{Y({handy:e,request:()=>s.hdsp.nextPositionAbsInTime(t,n),callback:{res:r,rej:i}})})),xpt:(t,n)=>new Promise(((r,i)=>{Y({handy:e,request:()=>s.hdsp.nextPositionPercentInTime(t,n),callback:{res:r,rej:i}})}))},HSSP:{loop:(t,n)=>new Promise(((r,i)=>{Y({handy:e,request:()=>s.hssp.setLoopSetting(t,n),callback:{res:r,rej:i}})})),play:(t,n)=>new Promise(((r,i)=>{Y({handy:e,skip:!0,request:()=>s.hssp.play(t,n),callback:{res:r,rej:i}})})),stop:t=>new Promise(((n,r)=>{Y({handy:e,request:()=>s.hssp.hsspStop(t),callback:{res:n,rej:r}})})),setup:(t,n)=>new Promise(((r,i)=>{Y({handy:e,request:()=>s.hssp.setup(t,n),callback:{res:r,rej:i}})}))},HSTP:{offset:(t,n)=>new Promise(((r,i)=>{Y({handy:e,request:()=>s.hstp.setOffset(t,n),callback:{res:r,rej:i}})}))},MAINTENANCE:{restart:(t,n)=>new Promise(((r,i)=>{Y({handy:e,request:()=>s.maintenance.restart(t,n),callback:{res:r,rej:i}})})),updatePerformFw:(t,n)=>new Promise(((r,i)=>{Y({handy:e,request:()=>s.maintenance.updatePerformFw(t,n),callback:{res:r,rej:i}})}))}}}};class st extends Error{constructor(t){super(t),this.name="HandyError"}}var rt,it,ot,at,ut,ct={},lt=[],dt=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i;function ht(t,e){for(var n in e)t[n]=e[n];return t}function pt(t){var e=t.parentNode;e&&e.removeChild(t)}function _t(t,e,n,s,r){var i={type:t,props:e,key:n,ref:s,__k:null,__:null,__b:0,__e:null,__d:void 0,__c:null,__h:null,constructor:void 0,__v:null==r?++ot:r};return null==r&&null!=it.vnode&&it.vnode(i),i}function ft(t){return t.children}function yt(t,e){this.props=t,this.context=e}function St(t,e){if(null==e)return t.__?St(t.__,t.__.__k.indexOf(t)+1):null;for(var n;e<t.__k.length;e++)if(null!=(n=t.__k[e])&&null!=n.__e)return n.__e;return"function"==typeof t.type?St(t):null}function mt(t){var e,n;if(null!=(t=t.__)&&null!=t.__c){for(t.__e=t.__c.base=null,e=0;e<t.__k.length;e++)if(null!=(n=t.__k[e])&&null!=n.__e){t.__e=t.__c.base=n.__e;break}return mt(t)}}function Et(t){(!t.__d&&(t.__d=!0)&&at.push(t)&&!gt.__r++||ut!==it.debounceRendering)&&((ut=it.debounceRendering)||setTimeout)(gt)}function gt(){for(var t;gt.__r=at.length;)t=at.sort((function(t,e){return t.__v.__b-e.__v.__b})),at=[],t.some((function(t){var e,n,s,r,i,o;t.__d&&(i=(r=(e=t).__v).__e,(o=e.__P)&&(n=[],(s=ht({},r)).__v=r.__v+1,At(o,r,s,e.__n,void 0!==o.ownerSVGElement,null!=r.__h?[i]:null,n,null==i?St(r):i,r.__h),Nt(n,r),r.__e!=i&&mt(r)))}))}function wt(t,e,n,s,r,i,o,a,u,c){var l,d,h,p,_,f,y,S=s&&s.__k||lt,m=S.length;for(n.__k=[],l=0;l<e.length;l++)if(null!=(p=n.__k[l]=null==(p=e[l])||"boolean"==typeof p?null:"string"==typeof p||"number"==typeof p||"bigint"==typeof p?_t(null,p,null,null,p):Array.isArray(p)?_t(ft,{children:p},null,null,null):p.__b>0?_t(p.type,p.props,p.key,p.ref?p.ref:null,p.__v):p)){if(p.__=n,p.__b=n.__b+1,null===(h=S[l])||h&&p.key==h.key&&p.type===h.type)S[l]=void 0;else for(d=0;d<m;d++){if((h=S[d])&&p.key==h.key&&p.type===h.type){S[d]=void 0;break}h=null}At(t,p,h=h||ct,r,i,o,a,u,c),_=p.__e,(d=p.ref)&&h.ref!=d&&(y||(y=[]),h.ref&&y.push(h.ref,null,p),y.push(d,p.__c||_,p)),null!=_?(null==f&&(f=_),"function"==typeof p.type&&p.__k===h.__k?p.__d=u=vt(p,u,t):u=Rt(t,p,h,S,_,u),"function"==typeof n.type&&(n.__d=u)):u&&h.__e==u&&u.parentNode!=t&&(u=St(h))}for(n.__e=f,l=m;l--;)null!=S[l]&&Dt(S[l],S[l]);if(y)for(l=0;l<y.length;l++)qt(y[l],y[++l],y[++l])}function vt(t,e,n){for(var s,r=t.__k,i=0;r&&i<r.length;i++)(s=r[i])&&(s.__=t,e="function"==typeof s.type?vt(s,e,n):Rt(n,s,s,r,s.__e,e));return e}function Rt(t,e,n,s,r,i){var o,a,u;if(void 0!==e.__d)o=e.__d,e.__d=void 0;else if(null==n||r!=i||null==r.parentNode)t:if(null==i||i.parentNode!==t)t.appendChild(r),o=null;else{for(a=i,u=0;(a=a.nextSibling)&&u<s.length;u+=2)if(a==r)break t;t.insertBefore(r,i),o=i}return void 0!==o?o:r.nextSibling}function Pt(t,e,n){"-"===e[0]?t.setProperty(e,n):t[e]=null==n?"":"number"!=typeof n||dt.test(e)?n:n+"px"}function Tt(t,e,n,s,r){var i;t:if("style"===e)if("string"==typeof n)t.style.cssText=n;else{if("string"==typeof s&&(t.style.cssText=s=""),s)for(e in s)n&&e in n||Pt(t.style,e,"");if(n)for(e in n)s&&n[e]===s[e]||Pt(t.style,e,n[e])}else if("o"===e[0]&&"n"===e[1])i=e!==(e=e.replace(/Capture$/,"")),e=e.toLowerCase()in t?e.toLowerCase().slice(2):e.slice(2),t.l||(t.l={}),t.l[e+i]=n,n?s||t.addEventListener(e,i?Ct:bt,i):t.removeEventListener(e,i?Ct:bt,i);else if("dangerouslySetInnerHTML"!==e){if(r)e=e.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if("href"!==e&&"list"!==e&&"form"!==e&&"tabIndex"!==e&&"download"!==e&&e in t)try{t[e]=null==n?"":n;break t}catch(t){}"function"==typeof n||(null==n||!1===n&&-1==e.indexOf("-")?t.removeAttribute(e):t.setAttribute(e,n))}}function bt(t){this.l[t.type+!1](it.event?it.event(t):t)}function Ct(t){this.l[t.type+!0](it.event?it.event(t):t)}function At(t,e,n,s,r,i,o,a,u){var c,l,d,h,p,_,f,y,S,m,E,g,w,v,R,P=e.type;if(void 0!==e.constructor)return null;null!=n.__h&&(u=n.__h,a=e.__e=n.__e,e.__h=null,i=[a]),(c=it.__b)&&c(e);try{t:if("function"==typeof P){if(y=e.props,S=(c=P.contextType)&&s[c.__c],m=c?S?S.props.value:c.__:s,n.__c?f=(l=e.__c=n.__c).__=l.__E:("prototype"in P&&P.prototype.render?e.__c=l=new P(y,m):(e.__c=l=new yt(y,m),l.constructor=P,l.render=It),S&&S.sub(l),l.props=y,l.state||(l.state={}),l.context=m,l.__n=s,d=l.__d=!0,l.__h=[],l._sb=[]),null==l.__s&&(l.__s=l.state),null!=P.getDerivedStateFromProps&&(l.__s==l.state&&(l.__s=ht({},l.__s)),ht(l.__s,P.getDerivedStateFromProps(y,l.__s))),h=l.props,p=l.state,d)null==P.getDerivedStateFromProps&&null!=l.componentWillMount&&l.componentWillMount(),null!=l.componentDidMount&&l.__h.push(l.componentDidMount);else{if(null==P.getDerivedStateFromProps&&y!==h&&null!=l.componentWillReceiveProps&&l.componentWillReceiveProps(y,m),!l.__e&&null!=l.shouldComponentUpdate&&!1===l.shouldComponentUpdate(y,l.__s,m)||e.__v===n.__v){for(l.props=y,l.state=l.__s,e.__v!==n.__v&&(l.__d=!1),l.__v=e,e.__e=n.__e,e.__k=n.__k,e.__k.forEach((function(t){t&&(t.__=e)})),E=0;E<l._sb.length;E++)l.__h.push(l._sb[E]);l._sb=[],l.__h.length&&o.push(l);break t}null!=l.componentWillUpdate&&l.componentWillUpdate(y,l.__s,m),null!=l.componentDidUpdate&&l.__h.push((function(){l.componentDidUpdate(h,p,_)}))}if(l.context=m,l.props=y,l.__v=e,l.__P=t,g=it.__r,w=0,"prototype"in P&&P.prototype.render){for(l.state=l.__s,l.__d=!1,g&&g(e),c=l.render(l.props,l.state,l.context),v=0;v<l._sb.length;v++)l.__h.push(l._sb[v]);l._sb=[]}else do{l.__d=!1,g&&g(e),c=l.render(l.props,l.state,l.context),l.state=l.__s}while(l.__d&&++w<25);l.state=l.__s,null!=l.getChildContext&&(s=ht(ht({},s),l.getChildContext())),d||null==l.getSnapshotBeforeUpdate||(_=l.getSnapshotBeforeUpdate(h,p)),R=null!=c&&c.type===ft&&null==c.key?c.props.children:c,wt(t,Array.isArray(R)?R:[R],e,n,s,r,i,o,a,u),l.base=e.__e,e.__h=null,l.__h.length&&o.push(l),f&&(l.__E=l.__=null),l.__e=!1}else null==i&&e.__v===n.__v?(e.__k=n.__k,e.__e=n.__e):e.__e=Ot(n.__e,e,n,s,r,i,o,u);(c=it.diffed)&&c(e)}catch(t){e.__v=null,(u||null!=i)&&(e.__e=a,e.__h=!!u,i[i.indexOf(a)]=null),it.__e(t,e,n)}}function Nt(t,e){it.__c&&it.__c(e,t),t.some((function(e){try{t=e.__h,e.__h=[],t.some((function(t){t.call(e)}))}catch(t){it.__e(t,e.__v)}}))}function Ot(t,e,n,s,r,i,o,a){var u,c,l,d=n.props,h=e.props,p=e.type,_=0;if("svg"===p&&(r=!0),null!=i)for(;_<i.length;_++)if((u=i[_])&&"setAttribute"in u==!!p&&(p?u.localName===p:3===u.nodeType)){t=u,i[_]=null;break}if(null==t){if(null===p)return document.createTextNode(h);t=r?document.createElementNS("http://www.w3.org/2000/svg",p):document.createElement(p,h.is&&h),i=null,a=!1}if(null===p)d===h||a&&t.data===h||(t.data=h);else{if(i=i&&rt.call(t.childNodes),c=(d=n.props||ct).dangerouslySetInnerHTML,l=h.dangerouslySetInnerHTML,!a){if(null!=i)for(d={},_=0;_<t.attributes.length;_++)d[t.attributes[_].name]=t.attributes[_].value;(l||c)&&(l&&(c&&l.__html==c.__html||l.__html===t.innerHTML)||(t.innerHTML=l&&l.__html||""))}if(function(t,e,n,s,r){var i;for(i in n)"children"===i||"key"===i||i in e||Tt(t,i,null,n[i],s);for(i in e)r&&"function"!=typeof e[i]||"children"===i||"key"===i||"value"===i||"checked"===i||n[i]===e[i]||Tt(t,i,e[i],n[i],s)}(t,h,d,r,a),l)e.__k=[];else if(_=e.props.children,wt(t,Array.isArray(_)?_:[_],e,n,s,r&&"foreignObject"!==p,i,o,i?i[0]:n.__k&&St(n,0),a),null!=i)for(_=i.length;_--;)null!=i[_]&&pt(i[_]);a||("value"in h&&void 0!==(_=h.value)&&(_!==t.value||"progress"===p&&!_||"option"===p&&_!==d.value)&&Tt(t,"value",_,d.value,!1),"checked"in h&&void 0!==(_=h.checked)&&_!==t.checked&&Tt(t,"checked",_,d.checked,!1))}return t}function qt(t,e,n){try{"function"==typeof t?t(e):t.current=e}catch(t){it.__e(t,n)}}function Dt(t,e,n){var s,r;if(it.unmount&&it.unmount(t),(s=t.ref)&&(s.current&&s.current!==t.__e||qt(s,null,e)),null!=(s=t.__c)){if(s.componentWillUnmount)try{s.componentWillUnmount()}catch(t){it.__e(t,e)}s.base=s.__P=null,t.__c=void 0}if(s=t.__k)for(r=0;r<s.length;r++)s[r]&&Dt(s[r],e,n||"function"!=typeof t.type);n||null==t.__e||pt(t.__e),t.__=t.__e=t.__d=void 0}function It(t,e,n){return this.constructor(t,n)}function Ht(t,e,n){var s,r,i;it.__&&it.__(t,e),r=(s="function"==typeof n)?null:n&&n.__k||e.__k,i=[],At(e,t=(!s&&n||e).__k=function(t,e,n){var s,r,i,o={};for(i in e)"key"==i?s=e[i]:"ref"==i?r=e[i]:o[i]=e[i];if(arguments.length>2&&(o.children=arguments.length>3?rt.call(arguments,2):n),"function"==typeof t&&null!=t.defaultProps)for(i in t.defaultProps)void 0===o[i]&&(o[i]=t.defaultProps[i]);return _t(t,o,s,r,null)}(ft,null,[t]),r||ct,ct,void 0!==e.ownerSVGElement,!s&&n?[n]:r?null:e.firstChild?rt.call(e.childNodes):null,i,!s&&n?n:r?r.__e:e.firstChild,s),Nt(i,t)}rt=lt.slice,it={__e:function(t,e,n,s){for(var r,i,o;e=e.__;)if((r=e.__c)&&!r.__)try{if((i=r.constructor)&&null!=i.getDerivedStateFromError&&(r.setState(i.getDerivedStateFromError(t)),o=r.__d),null!=r.componentDidCatch&&(r.componentDidCatch(t,s||{}),o=r.__d),o)return r.__E=r}catch(e){t=e}throw t}},ot=0,yt.prototype.setState=function(t,e){var n;n=null!=this.__s&&this.__s!==this.state?this.__s:this.__s=ht({},this.state),"function"==typeof t&&(t=t(ht({},n),this.props)),t&&ht(n,t),null!=t&&this.__v&&(e&&this._sb.push(e),Et(this))},yt.prototype.forceUpdate=function(t){this.__v&&(this.__e=!0,t&&this.__h.push(t),Et(this))},yt.prototype.render=ft,at=[],gt.__r=0;var Mt=0;function Ut(t,e,n,s,r){var i,o,a={};for(o in e)"ref"==o?i=e[o]:a[o]=e[o];var u={type:t,props:a,key:n,ref:i,__k:null,__:null,__b:0,__e:null,__d:void 0,__c:null,__h:null,constructor:void 0,__v:--Mt,__source:r,__self:s};if("function"==typeof t&&(i=t.defaultProps))for(o in i)void 0===a[o]&&(a[o]=i[o]);return it.vnode&&it.vnode(u),u}var xt,kt,Lt,jt,Kt=0,Bt=[],Vt=[],Gt=it.__b,Ft=it.__r,Xt=it.diffed,$t=it.__c,Wt=it.unmount;function zt(t,e){it.__h&&it.__h(kt,t,Kt||e),Kt=0;var n=kt.__H||(kt.__H={__:[],__h:[]});return t>=n.__.length&&n.__.push({__V:Vt}),n.__[t]}function Zt(t){return Kt=1,function(t,e,n){var s=zt(xt++,2);if(s.t=t,!s.__c&&(s.__=[n?n(e):oe(void 0,e),function(t){var e=s.__N?s.__N[0]:s.__[0],n=s.t(e,t);e!==n&&(s.__N=[n,s.__[1]],s.__c.setState({}))}],s.__c=kt,!kt.u)){kt.u=!0;var r=kt.shouldComponentUpdate;kt.shouldComponentUpdate=function(t,e,n){if(!s.__c.__H)return!0;var i=s.__c.__H.__.filter((function(t){return t.__c}));if(i.every((function(t){return!t.__N})))return!r||r.call(this,t,e,n);var o=!1;return i.forEach((function(t){if(t.__N){var e=t.__[0];t.__=t.__N,t.__N=void 0,e!==t.__[0]&&(o=!0)}})),!(!o&&s.__c.props===t)&&(!r||r.call(this,t,e,n))}}return s.__N||s.__}(oe,t)}function Yt(t,e){var n=zt(xt++,3);!it.__s&&ie(n.__H,e)&&(n.__=t,n.i=e,kt.__H.__h.push(n))}function Jt(t){return Kt=5,Qt((function(){return{current:t}}),[])}function Qt(t,e){var n=zt(xt++,7);return ie(n.__H,e)?(n.__V=t(),n.i=e,n.__h=t,n.__V):n.__}function te(){for(var t;t=Bt.shift();)if(t.__P&&t.__H)try{t.__H.__h.forEach(se),t.__H.__h.forEach(re),t.__H.__h=[]}catch(e){t.__H.__h=[],it.__e(e,t.__v)}}it.__b=function(t){"function"!=typeof t.type||t.__m||null===t.__?t.__m||(t.__m=t.__&&t.__.__m?t.__.__m:""):t.__m=(t.__&&t.__.__m?t.__.__m:"")+(t.__&&t.__.__k?t.__.__k.indexOf(t):0),kt=null,Gt&&Gt(t)},it.__r=function(t){Ft&&Ft(t),xt=0;var e=(kt=t.__c).__H;e&&(Lt===kt?(e.__h=[],kt.__h=[],e.__.forEach((function(t){t.__N&&(t.__=t.__N),t.__V=Vt,t.__N=t.i=void 0}))):(e.__h.forEach(se),e.__h.forEach(re),e.__h=[])),Lt=kt},it.diffed=function(t){Xt&&Xt(t);var e=t.__c;e&&e.__H&&(e.__H.__h.length&&(1!==Bt.push(e)&&jt===it.requestAnimationFrame||((jt=it.requestAnimationFrame)||ne)(te)),e.__H.__.forEach((function(t){t.i&&(t.__H=t.i),t.__V!==Vt&&(t.__=t.__V),t.i=void 0,t.__V=Vt}))),Lt=kt=null},it.__c=function(t,e){e.some((function(t){try{t.__h.forEach(se),t.__h=t.__h.filter((function(t){return!t.__||re(t)}))}catch(n){e.some((function(t){t.__h&&(t.__h=[])})),e=[],it.__e(n,t.__v)}})),$t&&$t(t,e)},it.unmount=function(t){Wt&&Wt(t);var e,n=t.__c;n&&n.__H&&(n.__H.__.forEach((function(t){try{se(t)}catch(t){e=t}})),n.__H=void 0,e&&it.__e(e,n.__v))};var ee="function"==typeof requestAnimationFrame;function ne(t){var e,n=function(){clearTimeout(s),ee&&cancelAnimationFrame(e),setTimeout(t)},s=setTimeout(n,100);ee&&(e=requestAnimationFrame(n))}function se(t){var e=kt,n=t.__c;"function"==typeof n&&(t.__c=void 0,n()),kt=e}function re(t){var e=kt;t.__c=t.__(),kt=e}function ie(t,e){return!t||t.length!==e.length||e.some((function(e,n){return e!==t[n]}))}function oe(t,e){return"function"==typeof e?e(t):e}var ae={exports:{}},ue={};function ce(t){function e(e,r,i,o){var a=r?n+e+t.e+r:n+e,u=a;if(i){var c=" "+u+t.m;for(var l in i)if(i.hasOwnProperty(l)){var d=i[l];!0===d?u+=c+l:d&&(u+=c+l+s+d)}}if(void 0!==o)for(var h=0,p=o.length;h<p;h++){var _=o[h];if(_&&"string"==typeof _.valueOf())for(var f=_.valueOf().split(" "),y=0;y<f.length;y++){var S=f[y];S!==a&&(u+=" "+S)}}return u}var n=t.n||"",s=t.v||t.m;return function(t,n){return function(s,r,i){return"string"==typeof s?Array.isArray(r)?e(t,s,void 0,r):e(t,s,r,i):e(t,n,s,r)}}}Object.defineProperty(ue,"__esModule",{value:!0});var le=ce({e:"-",m:"_"});ue.cn=le,ue.withNaming=ce,function(t){t.exports=ue}(ae);var de=[],he=[];!function(t,e){if(t&&"undefined"!=typeof document){var n,s=!0===e.prepend?"prepend":"append",r=!0===e.singleTag,i="string"==typeof e.container?document.querySelector(e.container):document.getElementsByTagName("head")[0];if(r){var o=de.indexOf(i);-1===o&&(o=de.push(i)-1,he[o]={}),n=he[o]&&he[o][s]?he[o][s]:he[o][s]=a()}else n=a();65279===t.charCodeAt(0)&&(t=t.substring(1)),n.styleSheet?n.styleSheet.cssText+=t:n.appendChild(document.createTextNode(t))}function a(){var t=document.createElement("style");if(t.setAttribute("type","text/css"),e.attributes)for(var n=Object.keys(e.attributes),r=0;r<n.length;r++)t.setAttribute(n[r],e.attributes[n[r]]);var o="prepend"===s?"afterbegin":"beforeend";return i.insertAdjacentElement(o,t),t}}('@import url("https://fonts.googleapis.com/css2?family=Hind:wght@500;700&display=swap");\n.uui {\n  position: relative;\n  display: inline-block;\n  --width: 180px;\n  --arrow-offset: calc(var(--width) / 2 - $arrow-width - $error-border-width);\n}\n.uui--default {\n  --button-background: #5b5e4d;\n  --button-background-hover: #4e5042;\n  --popup-background: #5b5e4d;\n}\n.uui--dark {\n  --button-background: #5c5c5c;\n  --button-background-hover: #484848;\n  --popup-background: #5c5c5c;\n}\n.uui--deprecated {\n  --popup-background: #b0813c;\n}\n.uui--compact {\n  --width: 80px;\n}\n.uui--slim .uui__button {\n  height: 40px;\n}\n.uui__button {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  padding: 0 15px;\n  border: none;\n  border-radius: 5px;\n  cursor: pointer;\n  background: var(--button-background);\n  color: #ffffff;\n  font-family: "Hind", sans-serif;\n  transition: background 0.3s;\n  width: var(--width);\n}\n.uui__button:focus {\n  outline: none;\n}\n.uui__button:hover {\n  background: var(--button-background-hover);\n  transition: background 0.3s;\n}\n.uui__button-status {\n  height: 10px;\n  width: 10px;\n  border-radius: 50%;\n  transition: background 0.5s;\n}\n.uui__button-status--green {\n  background: #bff69a;\n  transform: scale(1);\n  animation: handy-status-pulse 3s infinite;\n}\n.uui__button-status--blue {\n  background: #5a7cff;\n}\n.uui__button-status--orange {\n  background: #f7a74f;\n}\n.uui__button-status--red {\n  background: #dc3832;\n}\n.uui__button-icon {\n  height: 50px;\n  position: relative;\n  top: 3px;\n}\n.uui__button-text {\n  flex-grow: 1;\n}\n.uui__popup {\n  position: absolute;\n  z-index: 9999;\n  visibility: visible;\n  opacity: 1;\n  transition: visibility 0.3s, opacity 0.3s;\n}\n.uui__popup--hidden {\n  visibility: hidden;\n  opacity: 0;\n  transition: visibility 0.3s, opacity 0.3s;\n}\n.uui__popup-arrow {\n  position: relative;\n  border-width: 10px;\n  border-style: solid;\n  border-color: transparent transparent var(--popup-background);\n}\n.uui__popup-content {\n  border-radius: 5px;\n  overflow: hidden;\n  position: absolute;\n  box-shadow: 0 13px 27px -5px rgba(50, 50, 93, 0.25), 0 8px 16px -8px rgba(0, 0, 0, 0.3);\n  background: var(--popup-background);\n}\n.uui__popup-content iframe {\n  border: none;\n  width: 100%;\n  height: 100%;\n}\n.uui__popup-offline {\n  height: 100%;\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  color: #ffffff;\n  font-family: "Hind", sans-serif;\n  padding: 0 15px;\n  text-align: center;\n}\n.uui__popup-offline svg {\n  height: 100px;\n  margin-bottom: 16px;\n  fill: #9aa0a6;\n}\n.uui__popup-offline p {\n  margin: 0;\n}\n.uui__popup-offline p + p {\n  margin-top: 16px;\n}\n.uui__error {\n  position: absolute;\n  background: var(--button-background);\n  border: 1px solid #f27474;\n  border-radius: 5px;\n  top: calc(100% + 5px);\n  padding: 8px 18px 8px 9px;\n  font-size: 14px;\n  line-height: 1.6;\n  color: #ffffff;\n  display: flex;\n  align-items: center;\n  white-space: nowrap;\n  visibility: visible;\n  opacity: 1;\n  transition: visibility 0.3s, opacity 0.3s;\n}\n.uui__error--hidden {\n  visibility: hidden;\n  opacity: 0;\n  transition: visibility 0.3s, opacity 0.3s;\n}\n.uui__error--left {\n  left: 0;\n}\n.uui__error--left::before {\n  left: var(--arrow-offset);\n}\n.uui__error--center {\n  left: 50%;\n  transform: translateX(-50%);\n}\n.uui__error--center::before {\n  left: 50%;\n  transform: translateX(-50%);\n}\n.uui__error--right {\n  right: 0;\n}\n.uui__error--right::before {\n  right: var(--arrow-offset);\n}\n.uui__error::before {\n  content: "";\n  border-width: 5px 3px;\n  border-style: solid;\n  border-color: transparent transparent var(--button-background);\n  position: absolute;\n  bottom: 100%;\n}\n.uui__error-icon {\n  flex: 0 0 14px;\n  width: 14px;\n  margin-right: 8px;\n}\n\n@keyframes handy-status-pulse {\n  0% {\n    transform: scale(0.95);\n    box-shadow: 0 0 0 0 rgba(114, 201, 62, 0.7);\n  }\n  70% {\n    transform: scale(1);\n    box-shadow: 0 0 0 10px transparent;\n  }\n  100% {\n    transform: scale(0.95);\n    box-shadow: 0 0 0 0 transparent;\n  }\n}',{});const pe=ae.exports.withNaming({e:"__",m:"--"}),_e={[t.Status.NOT_CONNECTED]:"blue",[t.Status.CONNECTING]:"orange",[t.Status.CONNECTION_FAILED]:"red",[t.Status.CONNECTED]:"green",[t.Status.UPDATE]:"green",[t.Status.DEPRECATED]:"green",[t.Status.SETTING_SCRIPT]:"green"},fe={[t.Status.NOT_CONNECTED]:location.href.includes("handyfeeling.com")?"Connect":"The Handy",[t.Status.CONNECTING]:"Connecting...",[t.Status.CONNECTION_FAILED]:"Error",[t.Status.CONNECTED]:"Connected",[t.Status.UPDATE]:"Update",[t.Status.DEPRECATED]:"Update",[t.Status.SETTING_SCRIPT]:"Setting script..."},ye={[t.Status.NOT_CONNECTED]:"not-connected",[t.Status.CONNECTING]:"connecting",[t.Status.CONNECTION_FAILED]:"failed",[t.Status.CONNECTED]:"connected",[t.Status.UPDATE]:"update",[t.Status.DEPRECATED]:"deprecated",[t.Status.SETTING_SCRIPT]:"setting-script"},Se={[t.Status.UPDATE]:338,[t.Status.DEPRECATED]:189},me=({handy:e})=>{const n=pe("uui"),s=Jt(null),r=Jt(null),i=Jt(null),o=Jt(null),a=Jt(5),u=Jt(),c=Jt(),[l,d]=Zt(!0),[h,p]=Zt(),[_,f]=Zt(),[y,S]=Zt(),[m,E]=Zt(295),[g,w]=Zt(t.Status.NOT_CONNECTED),[v,R]=Zt(),[P,T]=Zt(!1),[b,C]=Zt(navigator.onLine),{URL:A,theme:N,compact:O,slim:q,storeURL:D,errorAlign:I}=e.getConfig().UUI,H=new URL(A);H.searchParams.set("theme",N),H.searchParams.set("storeURL",D);const M=function(t,e){return Kt=8,Qt((function(){return t}),e)}(((t,e)=>{o.current?.contentWindow?.postMessage({action:t,result:e},A)}),[A]);return Yt((()=>{const t=()=>{if(!s.current||!r.current)return;let t=l;const n=Math.min(innerWidth-40,780),i=r.current.getBoundingClientRect(),o=s.current.getBoundingClientRect(),a=n/2+20,u=o.left+o.width/2,c=window.innerWidth-o.right+o.width/2;let d=-(n/2-o.width/2);u<=a?d+=a-u:c<=a&&(d-=a-c);let h=-(i.width/2-o.width/2);const _=d+20,y=d+n-20-i.width-i.width/2;h<_?_+i.left-20>o.width?t=!0:h=_:h>y&&(y<0?t=!0:h=y),e.toggleUUI(!t),S(n),p(d),f(h)};return window.addEventListener("load",t),window.addEventListener("scroll",t),window.addEventListener("resize",t),t(),()=>{window.removeEventListener("load",t),window.removeEventListener("scroll",t),window.removeEventListener("resize",t)}}),[e,l]),Yt((()=>{const t=t=>{C("online"===t.type)};return window.addEventListener("online",t),window.addEventListener("offline",t),()=>{window.removeEventListener("online",t),window.removeEventListener("offline",t)}}),[]),Yt((()=>{const t=({state:t})=>{M("state",t),d(!t.uuiOpen),w(t.status),E(Se[t.status]||295);const e=t.error;clearTimeout(c.current),T(!!e),e?(R(t.error),c.current=window.setTimeout((()=>T(!1)),3e3)):c.current=window.setTimeout((()=>R(void 0)),300)};return e.on("state",t),()=>{e.off("state",t),clearTimeout(c.current)}}),[e,M]),Yt((()=>{if([t.Status.NOT_CONNECTED,t.Status.CONNECTION_FAILED].includes(g))return clearTimeout(u.current),void(u.current=void 0);if(u.current)return;const n=()=>{u.current=window.setTimeout((async()=>{try{const t=e.getState().connectionKey;if(!t)throw new Error("No connection key");const{connected:s}=await e.API.get.connected(t,!0);if(!s)throw new Error("Not connected");const r=await e.API.get.info(t);r.fwVersion>="3.2"&&await e.getOffset(),r.fwVersion>="3"&&await e.getStrokeZone(),e.updateState({connected:s,connecting:!1}),a.current=5}catch{if(!a.current)return e.updateState({connected:!1,connecting:!1});e.updateState({connecting:!0}),a.current--}finally{n()}}),3e4)};n()}),[e,g]),Yt((()=>{if(l)return;const t=t=>{const n=t.target;i.current?.contains(n)||i.current?.contains(n)||e.toggleUUI(!1)};return window.addEventListener("click",t),()=>window.removeEventListener("click",t)}),[e,l]),Yt((()=>{const t=async({data:t})=>{"getStoredKey"===t.action?M(t.action,await e.getStoredKey()):"connect"===t.action?e.connect(t.data):"disconnect"===t.action?e.disconnect():"setStrokeZone"===t.action?await e.setStrokeZone(t.data):"setOffset"===t.action?await e.setOffset(t.data):"sync"===t.action?e.sync().then((()=>M(t.action,void 0))):"init"===t.action&&M("init",e.getState())};return window.addEventListener("message",t),()=>window.removeEventListener("message",t)}),[e,M]),Ut("div",{className:n({[N]:!0,[ye[g]]:!0,compact:O,slim:q}),children:[Ut("button",{type:"button",className:n("button"),onClick:()=>e.toggleUUI(l),ref:s,children:[Ut("span",{className:n("button-status",{[_e[g]]:!0})}),Ut("svg",{className:n("button-icon"),xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 595.3 794.2",children:Ut("path",{d:"M288.8 215.2v269.2a73 73 0 0 1-75.6 73.4 72.4 72.4 0 0 1-68.9-72.2V216.3a73 73 0 0 1 69.4-73.3 72 72 0 0 1 53.8 21.2 72 72 0 0 1 21.3 51zM451 387.8v162.7H306.6V387.8a72.4 72.4 0 0 1 72.2-72.2 72.4 72.4 0 0 1 72.2 72.2z",fill:"#fff"})}),!O&&Ut("span",{className:n("button-text"),children:fe[g]})]}),Ut("div",{className:n("popup",{hidden:l||void 0===h||void 0===y||void 0===_}),children:[Ut("div",{className:n("popup-arrow"),ref:r,style:{left:`${_}px`}}),Ut("div",{className:n("popup-content"),ref:i,style:{left:`${h}px`,width:`${y}px`,height:`${m}px`},children:b?Ut("iframe",{src:H.toString(),ref:o}):Ut("div",{className:n("popup-offline"),children:[Ut("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:Ut("path",{d:"m7.73 10 8 8H6a4 4 0 0 1-4-4 4 4 0 0 1 4-4M3 5.27 5.75 8C2.56 8.15 0 10.77 0 14a6 6 0 0 0 6 6h11.73l2 2L21 20.73 4.27 4m15.08 6.03A7.49 7.49 0 0 0 12 4c-1.5 0-2.85.43-4 1.17l1.45 1.46C10.21 6.23 11.08 6 12 6a5.5 5.5 0 0 1 5.5 5.5v.5H19a3 3 0 0 1 3 3c0 1.13-.64 2.11-1.56 2.62l1.45 1.45C23.16 18.16 24 16.68 24 15c0-2.64-2.05-4.78-4.65-4.97Z"})}),Ut("p",{children:Ut("b",{children:"Offline Mode"})}),Ut("p",{children:"We canâ€™t reach Handy servers at the moment."})]})})]}),Ut("div",{className:n("error",{[I]:!0,hidden:!P||!l}),children:[Ut("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"5.49 4.54 51.16 51.24",className:n("error-icon"),children:[Ut("circle",{cx:"31.07",cy:"30.16",r:"24.5",fill:"none",stroke:"#f27474","stroke-width":"2.5"}),Ut("path",{stroke:"#f27474","stroke-linecap":"round","stroke-width":"2.5",d:"m22.55 21.52 17.33 17.54M39.66 21.52l-17.08 17.1"})]}),Ut("span",{children:v})]})]})};const Ee={lastInfoUpdate:0,status:t.Status.NOT_CONNECTED};let ge={avgOffset:0,avgRtd:0,lastSyncTime:0},we=!1;class ve{API;playingTimer;videoPlayer;#t;#e;#n={};#s=function(t){return{all:t=t||new Map,on:function(e,n){var s=t.get(e);s?s.push(n):t.set(e,[n])},off:function(e,n){var s=t.get(e);s&&(n?s.splice(s.indexOf(n)>>>0,1):t.set(e,[]))},emit:function(e,n){var s=t.get(e);s&&s.slice().map((function(t){t(n)})),(s=t.get("*"))&&s.slice().map((function(t){t(e,n)}))}}}();#r;#i;constructor(t={}){this.#t=Ee,this.#e=n(e,t),this.API=nt(this)}async updateState(t){if(Object.keys(t).length){for(const e in t){const n=e,s=t[n],r=this.#t[n];this.#t="object"==typeof r&&"object"==typeof s?{...this.#t,[n]:Object.assign(r,s)}:{...this.#t,[n]:s}}this.#t.status=this.#o(),this.#s.emit("state",{state:this.#t,change:t}),this.#t.connectionKey&&await this.#a(this.#t)}}getState(){return this.#t}updateConfig(t){this.#e=n(this.#e,t),this.API=nt(this)}getConfig(){return this.#e}async connect(e){const n=await this.#u(e);if(this.#t.connected&&(this.#i?.(),this.#c(),this.#s.emit("disconnect")),0===ge.lastSyncTime){const t=await this.#l("clientServerLatency");void 0!==t&&(ge=t)}this.#t={...Ee,uuiOpen:this.#t.uuiOpen},await this.updateState({connecting:!0,latency:ge});let s={connecting:!1};try{const{connected:r}=await this.API.get.connected(e,!0);if(s.connected=r,s.connectionKey=e,!r)throw await this.updateState({error:"Device is not connected"}),new st("Device is not connected");const i=await this.API.get.info(e,!0);s.info=i,s.ota=await this.API.get.OTA.latest(i.model,i.branch,!0);const{syncClientServerTime:o,timeBetweenSyncs:a}=this.#e;if(n.info?.sessionId!==i.sessionId){const{slideMin:n,slideMax:r}=await this.API.get.settings(e,!0);s.slide={min:n,max:r};const{mode:o,state:a}=await this.API.get.status(e,!0);if(o===t.Mode.HSSP&&(s.hssp={state:a}),o===t.Mode.HAMP&&(s.hamp={state:a}),i.fwVersion>="3.2"){const{offset:t}=await this.API.get.HSTP.offset(e,!0);s.hstp={offset:t}}s.lastInfoUpdate=Date.now()}else s={...n,...s};const u=Date.now()-ge.lastSyncTime;return o&&!we&&u>a&&await this.syncClientServerTime(),await this.updateState(s),this.#s.emit("connect"),t.ConnectResult.CONNECTED}catch{return await new Promise((t=>setTimeout(t,1e3))),await this.updateState(s),t.ConnectResult.NOT_CONNECTED}}async disconnect(t=!0){if(t)await this.#d("handyStates");else{const t=(await this.#l("handyStates")||[]).filter((t=>t.connectionKey!==this.#t.connectionKey));await this.#h("handyStates",t)}this.#t={...Ee,uuiOpen:this.#t.uuiOpen},this.#s.emit("disconnect"),this.#s.emit("state",{state:this.#t,change:{}})}on(t,e){this.#s.on(t,e)}off(t,e){this.#s.off(t,e)}attachUUI(t="handy-ui"){!function(t,e){const n=document.getElementById(e);if(!n||!n.parentElement)throw new st(`Element with ${e} ID is not found`);Ht(Ut(me,{handy:t}),n.parentElement,n)}(this,t)}async toggleUUI(t=!0){t!==this.#t.uuiOpen&&await this.updateState({uuiOpen:t,error:void 0})}getClientServerLatency(){return ge}async getStoredKey(){const t=await this.#l("handyStates");return t?.length?t[t.length-1].connectionKey:void 0}setVideoPlayer(e){if(this.#c(),e){if(!(e instanceof HTMLVideoElement))throw new st("Provided element is not instance of HTMLVideoElement");this.#r=async()=>{await this.hsspPlay(1e3*e.currentTime),this.playingTimer=setTimeout((()=>{this.hsspPlay(1e3*e.currentTime)}),this.#e.videoPlayerDelayForSecondPlay)},this.#i=()=>{this.getState().hssp?.state===t.HSSPState.PLAYING&&this.hsspStop()},e.addEventListener("playing",this.#r),e.addEventListener("pause",this.#i),this.videoPlayer=e}}async setMode(e){const n=await this.#p();return this.#_(),this.#f("setMode",(async()=>{const s=await this.API.put.mode(n,{mode:e});if(s.result!==t.ModeUpdateResponse.result.ERROR){const t={mode:e};this.#t.hssp?.scriptSet&&(t.hssp={scriptSet:!1}),await this.updateState(t)}return s}))}async getMode(){const t=await this.#p();return this.#_(),this.#f("getMode",(()=>this.API.get.mode(t)))}async syncClientServerTime(t){if(we)return;we=!0;const{syncCount:e,outliers:n}={...this.#e.syncClient,...t},s=[];for(;s.length<e;)try{const t=await this.#y();s.push(t)}catch{return void(we=!1)}s.sort(((t,e)=>t.rtd-e.rtd));let r=Math.max(0,s.length-n-1),i=0,o=0;for(let t=0;t<r;t++){const e=s[t];e.offset&&e.rtd&&(i+=e.offset,o+=e.rtd)}0===r&&(r=1);const a={avgOffset:Math.round(i/r),avgRtd:Math.round(o/r),lastSyncTime:Date.now()};await this.#h("clientServerLatency",a),ge=a,we=!1,await this.updateState({latency:a})}async syncHandyServerTime(t){const e=await this.#p();this.#_("3.2");const{syncCount:n,outliers:s}={...this.#e.syncHandy,...t};return this.#f("syncHandyServerTime",(()=>this.API.get.HSTP.sync(e,n,s)))}async sync(t,e){await Promise.all([this.syncClientServerTime(t),this.syncHandyServerTime(e)])}async getHandyRtd(){const t=await this.#p();return this.#_("3.2"),this.#f("getHandyRtd",(()=>this.API.get.HSTP.rtd(t)))}async setOffset(e){const n=await this.#p();return this.#_("3.2"),this.#f("setOffset",(async()=>{const s=await this.API.put.HSTP.offset(n,{offset:e});return s.result===t.GenericResult.SUCCESS&&await this.updateState({hstp:{offset:e}}),s}))}async getOffset(){const t=await this.#p();return this.#_("3.2"),this.#f("getOffset",(()=>this.API.get.HSTP.offset(t)))}async setStrokeZone(t={min:0,max:100}){const e=await this.#p();this.#_();const n="min"in t,s="max"in t;if(!n&&!s)throw new st("Min or max position value is required");if(n&&(t.min<0||t.min>100))throw new st("Slide min position should be in range between 0 and 100");if(s&&(t.max<0||t.max>100))throw new st("Slide max position should be in range between 0 and 100");return this.#f("setStrokeZone",(async()=>{const n=await this.API.put.slide(e,t);return await this.updateState({slide:t}),n}))}async getStrokeZone(){const t=await this.#p();return this.#_(),this.#f("getStrokeZone",(()=>this.API.get.slide(t)))}async getAbsolutePosition(){const t=await this.#p();return this.#_(),this.#f("getAbsolutePosition",(()=>this.API.get.slidePositionAbsolute(t)))}async hampPlay(){const e=await this.#p();return this.#_(),this.#f("hampPlay",(async()=>{this.#t.mode!==t.Mode.HAMP&&await this.setMode(t.Mode.HAMP);const n=await this.API.put.HAMP.start(e);return n.result!==t.StateResult.ERROR&&await this.API.get.HAMP.state(e),n}))}async hampStop(){const e=await this.#p();return this.#_(),this.#f("hampStop",(async()=>{this.#t.mode!==t.Mode.HAMP&&await this.setMode(t.Mode.HAMP);const n=await this.API.put.HAMP.stop(e);if(n.result!==t.StateResult.ERROR){const{state:t}=await this.API.get.HAMP.state(e,!0);await this.updateState({hamp:{state:t,velocity:0}})}return n}))}async setHampVelocity(e){const n=await this.#p();this.#_();const{hamp:s,mode:r}=this.#t;if(s?.state!==t.HAMPState.MOVING)throw new st("Velocity can only be set when the slide is moving");if(e<0||e>100)throw new st("Velocity should be in range between 0 and 100");return this.#f("setHampVelocity",(async()=>{r!==t.Mode.HAMP&&await this.setMode(t.Mode.HAMP);const s=await this.API.put.HAMP.velocity(n,{velocity:e});return s.result===t.GenericResult.SUCCESS&&await this.updateState({hamp:{velocity:e}}),s}))}async getHampVelocity(){const e=await this.#p();return this.#_(),this.#f("getHampVelocity",(async()=>(this.#t.mode!==t.Mode.HAMP&&await this.setMode(t.Mode.HAMP),this.API.get.HAMP.velocity(e))))}async setScript(e){const n=await this.#p();return this.#_(),this.#f("setScript",(async()=>{await this.updateState({settingScript:!0}),this.#t.mode!==t.Mode.HSSP&&await this.setMode(t.Mode.HSSP);const s=await this.API.put.HSSP.setup(n,{url:e});return await this.API.get.HSSP.state(n),await this.updateState({hssp:{scriptSet:!0},settingScript:!1}),s}))}setScriptFromData(t){return this.#f("setScriptFromData",(async()=>{const e=await Re(t,this.#e.scriptAPI);return this.setScript(e)}))}async hsspPlay(e=0,n=be()){const s=await this.#p();this.#_();const{hssp:r,mode:i}=this.#t;if(!r?.scriptSet)throw await this.updateState({error:"Script set is required"}),new st("Script set is required");return clearTimeout(this.playingTimer),this.#f("hsspPlay",(async()=>{i!==t.Mode.HSSP&&await this.setMode(t.Mode.HSSP);const r=await this.API.put.HSSP.play(s,{startTime:Math.round(e),estimatedServerTime:Math.round(n)});return r.result===t.HSSPPlayResult.SUCCESS&&await this.API.get.HSSP.state(s),r}))}async hsspStop(){const e=await this.#p();return this.#_(),clearTimeout(this.playingTimer),this.#f("hsspStop",(async()=>{this.#t.mode!==t.Mode.HSSP&&await this.setMode(t.Mode.HSSP);const n=await this.API.put.HSSP.stop(e);return n.result===t.GenericResult.SUCCESS&&await this.API.get.HSSP.state(e),n}))}async setHsspLoop(e=!0){const n=await this.#p();return this.#_("3.2"),this.#f("setHsspLoop",(async()=>{this.#t.mode!==t.Mode.HSSP&&await this.setMode(t.Mode.HSSP);const s=await this.API.put.HSSP.loop(n,{activated:e});return s.result===t.GenericResult.SUCCESS&&await this.updateState({hssp:{loop:e}}),s}))}async getHsspLoop(){const e=await this.#p();return this.#_("3.2"),this.#f("getHsspLoop",(async()=>{this.#t.mode!==t.Mode.HSSP&&await this.setMode(t.Mode.HSSP);const{activated:n,...s}=await this.API.get.HSSP.loop(e);return{...s,loop:n}}))}async hdsp(e,n,s,r,i,o){const a=await this.#p();return this.#_(),this.#f("hdsp",(async()=>{if(this.#t.mode!==t.Mode.HDSP&&await this.setMode(t.Mode.HDSP),"absolute"===s&&"percent"===r)throw new st('"absolute" position type is not available for "percent" speed type');if("absolute"===s){if(e<0)throw new st("Position can not be negative");if(n<0)throw new st(("time"===r?"Time":"Velocity")+" can not be negative");return"time"===r?this.API.put.HDSP.xat(a,{stopOnTarget:i,immediateResponse:o,position:e,duration:n}):this.API.put.HDSP.xava(a,{stopOnTarget:i,immediateResponse:o,position:e,velocity:n})}if(e<0||e>100)throw new st("Position should be in range between 0 and 100");if("time"===r){if(n<0)throw new st("Time can not be negative");return this.API.put.HDSP.xpt(a,{stopOnTarget:i,immediateResponse:o,position:e,duration:n})}if("absolute"===r){if(n<0)throw new st("Velocity can not be negative");return this.API.put.HDSP.xpva(a,{stopOnTarget:i,immediateResponse:o,position:e,velocity:n})}if(n<0||n>100)throw new st("Velocity should be in range between 0 and 100");return this.API.put.HDSP.xpvp(a,{stopOnTarget:i,immediateResponse:o,position:e,velocity:n})}))}async restartHandy(e=!0){const n=await this.#p();return this.#_(),this.#f("restartHandy",(async()=>(this.#t.mode!==t.Mode.MAINTENANCE&&await this.setMode(t.Mode.MAINTENANCE),this.API.put.MAINTENANCE.restart(n,{reconnect:e}))))}async#y(){const t=Date.now(),{serverTime:e}=await this.API.get.serverTime(),n=Date.now(),s=n-t;return{rtd:s,offset:e+s/2-n}}async#f(t,e){const n=e=>{this.#n[t]={...this.#n[t],...e}};clearTimeout(this.#n[t]?.timer);const s=this.#n[t]?.promise;if(s){const t=setTimeout((()=>e().finally((()=>n({timer:void 0})))),this.#e.throttleDelay);return n({timer:t}),s}const r=e().finally((()=>setTimeout((()=>n({promise:void 0})),this.#e.throttleDelay)));return n({promise:r}),r}async#p(){const{connectionKey:t}=this.#t;if(!t)throw await this.updateState({error:"No device connected"}),new st("No device connected");return t}#_(t="3"){if(!this.#S(t))throw new st("Update required")}#S(t){const{info:e}=this.#t;return!!e?.fwVersion&&e.fwVersion>=t}#o(){const{connecting:e,connected:n,connectionKey:s,info:r,ota:i,settingScript:o}=this.#t;if(e)return t.Status.CONNECTING;if(n){if(r){if(r.fwVersion<"3")return t.Status.DEPRECATED;if(i){if(r.fwVersion.split("+")[0]!==i.fwVersion.split("+")[0])return t.Status.UPDATE}}return o?t.Status.SETTING_SCRIPT:t.Status.CONNECTED}return s?t.Status.CONNECTION_FAILED:t.Status.NOT_CONNECTED}#c(){this.#r&&(this.videoPlayer?.removeEventListener("playing",this.#r),this.#r=void 0),this.#i&&(this.videoPlayer?.removeEventListener("pause",this.#i),this.#i=void 0)}async#h(t,e,n){const{localStorage:s}=this.#e;if(!s)return;let r=n?{[n]:e}:e;if(n)try{r={...JSON.parse(await s.getItem(t)||""),...r}}catch{}s.setItem(t,JSON.stringify(r))}async#l(t){const{localStorage:e}=this.#e;if(!e)return;let n;try{n=JSON.parse(await e.getItem(t)||"")}catch{}return n}async#d(t){const{localStorage:e}=this.#e;await(e?.removeItem(t))}async#u(t){const e=(await this.#l("handyStates"))?.find((e=>e.connectionKey===t));return e||Ee}async#a(t){const{mode:e,uuiOpen:n,error:s,settingScript:r,...i}=t,o=(await this.#l("handyStates")||[]).filter((e=>e.connectionKey!==t.connectionKey));o.push(i),await this.#h("handyStates",o)}}async function Re(t,n=e.scriptAPI){const s=Te(t),r=new Blob([s],{type:"text/plain;charset=utf-8;"}),i=new FormData;i.append("file",r,`${Math.round(1e8*Math.random())}.csv`);const o=await fetch(`${n}/temp/upload`,{method:"POST",headers:{accept:"application/json"},body:i}),a=await o.json();if("error"in a)throw new st(a.error);return a.url}function Pe(t){const e=t.trim().split("\n").filter((t=>"#"!==t.trim()[0]));if(e.length<2)return!1;for(const t of e){if(2!==t.trim().split(",").map((t=>parseInt(t,10))).filter((t=>!isNaN(t))).length)return!1}return!0}function Te(t,e="\n"){if("string"!=typeof t){if(t.actions?.length<2)throw new st("Need at least 2 points");return t.actions.reduce(((t,n)=>`${t}${Math.round(n.at)},${Math.round(n.pos)}${e}`),"#Created by Handy SDK v2\n")}try{return Te(JSON.parse(t))}catch{if(!Pe(t))throw new st("Invalid CSV");return t}}function be(){return Date.now()+ge.avgOffset}t.convertDataToCSV=Te,t.getEstimatedServerTime=be,t.init=function(t={}){return new ve(t)},t.isValidCSV=Pe,t.uploadDataToServer=Re,Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=handy.umd.js.map
